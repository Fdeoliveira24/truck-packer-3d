# Account Deletion UI & Logic Audit

## Summary

This document summarizes the findings from an audit of the account deletion UI, confirmation text,
call-sites, and error handling in the Truck Packer 3D codebase (main branch, as of Jan 30, 2026).

---

## 1. Main UI Source for Account Deletion

- **Primary UI:**
  - File: `src/ui/overlays/settings-overlay.js`
  - Location: Danger Zone section, "Delete Account" button.
  - Modal confirmation uses the string: `To confirm this, type "REQUEST DELETION"` and requires the
    user to type exactly that to enable the delete action.
  - Modal title: `Request Account Deletion`
  - Confirmation input placeholder: `Type REQUEST DELETION`
  - Confirm button: `Request Deletion`
  - On confirm, calls `SupabaseClient.requestAccountDeletion()`.
  - On error, shows a toast: `Request failed: ...` (with error message).

---

## 2. Additional Delete Flows

- **Account Overlay:**
  - File: `src/ui/overlays/account-overlay.js`
  - Also contains a "Delete Account" button.
  - Uses a simple `confirm()` dialog (not a modal with typed confirmation).
  - On confirm, calls `SupabaseClient.requestAccountDeletion()`.
  - On error, shows an `alert()` with the error message.

---

## 3. Backend/Client Logic

- **Request Function:**
  - File: `src/core/supabase-client.js`
  - Function: `requestAccountDeletion()`
  - Calls the Supabase Edge Function `request-account-deletion` with the user's access token.
  - Throws on error; returns true on success.

---

## 4. Error Handling & Messaging

- **Settings Overlay:**
  - Uses `UIComponents.showToast` for error/success feedback.
- **Account Overlay:**
  - Uses `alert()` for error feedback.
- **Edge Function errors:**
  - If the Edge Function is unreachable or fails, the error message is surfaced to the user via the
    above mechanisms.

---

## 5. Offline Handling

- **Current State:**
  - No explicit offline guard in the delete confirm handlers; if offline, the Edge Function call
    will fail and the user will see a generic error message.
  - Other parts of the app (auth overlay, signOut) do check `navigator.onLine` for offline UX.

---

## 6. UI Strings (Authoritative Sources)

- **"REQUEST DELETION"**: Used in settings overlay modal for typed confirmation.
- **"Request Account Deletion"**: Modal title in settings overlay.
- **"Delete Account"**: Button label in both overlays.

---

## 7. Recommendations (if changes are needed)

- If you want to update the confirmation string or add offline-friendly messaging, the minimal
  change is to edit `src/ui/overlays/settings-overlay.js` (and optionally `account-overlay.js` if
  you want consistency).
- For offline UX, add a `navigator.onLine` check before calling `requestAccountDeletion()` and show
  a friendly toast if offline.

---

## 8. No Backend Changes Needed

- All logic for deletion is already routed through the client helper and Edge Function.
- No changes to `supabase-client.js` or Edge Functions are required for UI copy or offline UX
  improvements.

---

## 9. References

- `src/ui/overlays/settings-overlay.js` (Danger Zone modal, lines ~1260-1400)
- `src/ui/overlays/account-overlay.js` (Danger Zone, lines ~180-260)
- `src/core/supabase-client.js` (requestAccountDeletion, lines ~440-560)

---

_Generated by GitHub Copilot, Jan 30, 2026._
