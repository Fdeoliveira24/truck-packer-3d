<!doctype html>
<!--
  TRUCK PACKER 3D
  Version: 1.0.0 (MVP)
  A production-ready, single-file 3D logistics planning workspace.

  QUICK START:
  1) Open this file in a modern browser (Chrome/Edge/Firefox/Safari).
  2) Create cases (Cases) and a project (Packs).
  3) Open a pack (Editor), add cases, drag to place, or AutoPack.

  NOTE:
  - Works on file:// for demos. For best results, run on http(s):// (some browsers restrict features on file://).
  - CDN libraries are required; if any CDN fails, the app shows a recovery message.
-->
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>Truck Packer 3D</title>

    <!-- ===== BOOT: CDN failure capture (must run before vendor scripts) ===== -->
    <!-- Pre-init: capture CDN failures before app boot -->
    <script>
      (function () {
        'use strict';
        window.__TP3D_BOOT = window.__TP3D_BOOT || { cdnFailures: [] };
        window.__tp3dCdnFail = function (name, url) {
          try {
            window.__TP3D_BOOT.cdnFailures.push({ name: String(name || 'CDN'), url: String(url || '') });
          } catch (_) {
            // Ignore errors if boot object is not available
          }
        };
      })();
    </script>

    <!-- 3D Rendering (ES Modules) -->
    <!--
      NOTE (compatibility): Import maps are not supported in Safari 14, so we avoid them.
      We load ESM via esm.sh, which rewrites internal bare imports for broad compatibility.
    -->
    <script type="module">
      window.__TP3D_BOOT = window.__TP3D_BOOT || { cdnFailures: [] };
      // ===== BOOT: THREE.js ESM loader (sets window.THREE + OrbitControls) =====
      window.__TP3D_BOOT.threeReady = (async function () {
        try {
          const ThreeModule = await import('https://esm.sh/three@0.160.0');
          const Orbit = await import('https://esm.sh/three@0.160.0/examples/jsm/controls/OrbitControls.js');
          window.THREE = { ...ThreeModule, OrbitControls: Orbit.OrbitControls };
          return true;
        } catch (err) {
          window.__tp3dCdnFail('three@0.160.0 (ESM) / OrbitControls', 'https://esm.sh/three@0.160.0');
          console.error(err);
          return false;
        }
      })();
    </script>

    <!-- Animation -->
    <!-- ===== VENDOR: TWEEN.js ===== -->
    <script
      src="https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@23.1.1/dist/tween.umd.js"
      onerror="
        __tp3dCdnFail(
          '@tweenjs/tween.js@23.1.1',
          'https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@23.1.1/dist/tween.umd.js'
        )
      "
    ></script>

    <!-- PDF Generation -->
    <!-- ===== VENDOR: jsPDF ===== -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
      onerror="__tp3dCdnFail('jsPDF@2.5.1', 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js')"
    ></script>

    <!-- Excel/CSV Import -->
    <!-- ===== VENDOR: XLSX ===== -->
    <script
      src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"
      onerror="__tp3dCdnFail('xlsx@0.18.5', 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js')"
    ></script>

    <!-- UI Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      onerror="
        __tp3dCdnFail('Font Awesome 6.5.1', 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css')
      "
    />

    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- ===== STYLES: App CSS (single-file) ===== -->
    <style>
      :root {
        /* Backgrounds */
        --bg-primary: #f6f7fb;
        --bg-secondary: #ffffff;
        --bg-elevated: #ffffff;
        --bg-hover: #f0f1f5;

        /* Text */
        --text-primary: #1a1a1f;
        --text-secondary: #6b6b78;
        --text-muted: #9b9ba8;
        --text-inverse: #ffffff;

        /* Borders */
        --border-subtle: #e6e8ef;
        --border-strong: #d1d3dd;

        /* Accent */
        --accent-primary: #ff9f1c;
        --accent-hover: #ffb547;
        --accent-pressed: #e88c0c;

        /* Semantic */
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        --info: #3b82f6;
        --pattern-line: rgba(26, 26, 31, 0.012);

        /* Shadows */
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);

        /* Typography */
        --font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 2rem;
        --font-normal: 400;
        --font-medium: 500;
        --font-semibold: 600;
        --font-bold: 700;
        --leading-tight: 1.25;
        --leading-normal: 1.5;
        --leading-relaxed: 1.75;

        /* Spacing */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.5rem;
        --space-6: 2rem;
        --space-8: 3rem;
        --space-10: 4rem;
        --space-12: 6rem;

        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 14px;
      }

      [data-theme='dark'] {
        --bg-primary: #121318;
        --bg-secondary: #1c1e26;
        --bg-elevated: #25252d;
        --bg-hover: #2a2d39;

        --text-primary: #ffffff;
        --text-secondary: #a0a0ab;
        --text-muted: #6b6b78;
        --text-inverse: #1a1a1f;

        --border-subtle: #2a2d39;
        --border-strong: #3a3a47;
        --pattern-line: rgba(255, 255, 255, 0.018);

        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: var(--font-family);
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: var(--leading-normal);
      }

      a {
        color: inherit;
      }

      .app {
        display: grid;
        grid-template-columns: 240px 1fr;
        grid-template-rows: 100vh;
      }

      .app.sidebar-collapsed {
        grid-template-columns: 0px 1fr;
      }

      .app.sidebar-collapsed .sidebar {
        transform: translateX(-102%);
        width: 0;
        min-width: 0;
        padding: 0;
        overflow: hidden;
        pointer-events: none;
        border-right: none;
      }

      .sidebar {
        background: var(--bg-secondary);
        border-right: 1px solid var(--border-subtle);
        display: flex;
        flex-direction: column;
        min-width: 240px;
      }

      .sidebar-header {
        padding: var(--space-5) var(--space-4);
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        align-items: center;
        gap: var(--space-3);
      }

      .brand-mark {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        background: linear-gradient(135deg, var(--accent-primary), #ffd166);
        box-shadow: var(--shadow-md);
      }

      .brand-text {
        display: flex;
        flex-direction: column;
      }

      .brand-name {
        font-weight: var(--font-bold);
        font-size: var(--text-base);
        letter-spacing: 0.2px;
      }

      .brand-sub {
        font-size: var(--text-xs);
        color: var(--text-secondary);
      }

      .nav {
        padding: var(--space-3);
        display: flex;
        flex-direction: column;
        gap: var(--space-1);
        overflow: auto;
      }

      .nav-btn {
        all: unset;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-3) var(--space-3);
        border-radius: var(--radius-sm);
        color: var(--text-secondary);
        font-size: var(--text-sm);
      }

      .nav-btn:hover {
        background: var(--bg-hover);
        color: var(--text-primary);
      }

      .nav-btn.active {
        background: rgba(255, 159, 28, 0.14);
        color: var(--text-primary);
        border: 1px solid rgba(255, 159, 28, 0.25);
      }

      .trial-card {
        background: linear-gradient(180deg, var(--bg-elevated), var(--bg-secondary));
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: var(--space-4);
        box-shadow: var(--shadow-sm);
      }

      .trial-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--space-3);
        margin-bottom: var(--space-3);
      }

      .trial-title {
        font-weight: var(--font-semibold);
        font-size: var(--text-sm);
      }

      .trial-sub {
        color: var(--text-secondary);
        font-size: var(--text-xs);
      }

      .main {
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-width: 0;
      }

      .topbar {
        height: 58px;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--space-4);
        gap: var(--space-4);
      }

      .topbar-left,
      .topbar-right {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        min-width: 0;
      }

      .topbar-title {
        display: flex;
        flex-direction: column;
        min-width: 0;
      }

      .topbar-title h1 {
        margin: 0;
        font-size: var(--text-lg);
        font-weight: var(--font-semibold);
        line-height: var(--leading-tight);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .topbar-subtitle {
        font-size: var(--text-xs);
        color: var(--text-secondary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .content {
        flex: 1;
        overflow: auto;
        padding: var(--space-5);
        background-color: var(--bg-primary);
        background-image:
          linear-gradient(var(--pattern-line) 1px, transparent 1px),
          linear-gradient(90deg, var(--pattern-line) 1px, transparent 1px);
        background-size:
          28px 28px,
          28px 28px;
      }

      .content.editor-mode {
        padding: 0;
        overflow: hidden;
        background-image: none;
      }

      .screen {
        display: none;
      }

      .screen.active {
        display: block;
      }

      .row {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        flex-wrap: wrap;
      }

      .row.space-between {
        justify-content: space-between;
      }

      .btn {
        border: 1px solid var(--border-subtle);
        background: var(--bg-elevated);
        color: var(--text-primary);
        border-radius: var(--radius-sm);
        padding: var(--space-2) var(--space-3);
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        box-shadow: var(--shadow-sm);
        transition:
          transform 0.15s ease,
          background 0.15s ease,
          box-shadow 0.15s ease,
          border-color 0.15s ease;
      }

      .btn:hover {
        background: var(--bg-hover);
        box-shadow: var(--shadow-md);
        transform: translateY(-1px);
      }

      .btn:active {
        transform: translateY(0px);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .btn-primary {
        border-color: rgba(255, 159, 28, 0.4);
        background: var(--accent-primary);
        color: var(--text-inverse);
      }

      .btn-primary:hover {
        background: var(--accent-hover);
      }

      .btn-danger {
        border-color: rgba(239, 68, 68, 0.4);
        background: rgba(239, 68, 68, 0.12);
        color: var(--text-primary);
      }

      /* Icon + checkbox theming (keep consistent across the app) */
      .btn i {
        color: var(--text-secondary);
      }

      .btn:hover i {
        color: var(--text-primary);
      }

      .btn-primary i,
      .btn-primary:hover i {
        color: currentColor;
      }

      .btn-danger i,
      .btn-danger:hover i {
        color: var(--error);
      }

      .btn-ghost {
        border-color: transparent;
        background: transparent;
        box-shadow: none;
        color: var(--text-secondary);
      }

      .btn-ghost:hover {
        background: var(--bg-hover);
        box-shadow: none;
        transform: none;
        color: var(--text-primary);
      }

      input[type='checkbox'] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border: 2px solid var(--border-strong);
        border-radius: 3px;
        cursor: pointer;
        position: relative;
        background: var(--bg-secondary);
        transition: all 0.15s ease;
      }

      input[type='checkbox']:hover {
        border-color: var(--accent-primary);
      }

      input[type='checkbox']:checked {
        background: var(--accent-primary);
        border-color: var(--accent-primary);
      }

      input[type='checkbox']:checked::after {
        content: '';
        position: absolute;
        left: 4px;
        top: 1px;
        width: 4px;
        height: 8px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }

      input[type='checkbox']:focus-visible {
        outline: 2px solid rgba(255, 159, 28, 0.35);
        outline-offset: 2px;
      }

      .input,
      .select,
      textarea {
        width: 100%;
        background: var(--bg-primary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        padding: var(--space-2) var(--space-3);
        font-size: var(--text-sm);
        color: var(--text-primary);
        transition:
          border-color 0.15s ease,
          box-shadow 0.15s ease;
      }

      textarea {
        min-height: 84px;
        resize: vertical;
      }

      .input:focus,
      .select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(255, 159, 28, 0.14);
      }

      .search-shell {
        display: grid;
        gap: 6px;
      }

      .search-input {
        position: relative;
        display: flex;
        align-items: center;
        background: var(--bg-secondary);
        border-radius: var(--radius-sm);
        border: 1px solid var(--border-subtle);
        box-shadow: var(--shadow-sm);
      }

      .search-input .input {
        border: none;
        box-shadow: none;
        padding-left: 34px;
        flex: 1;
        min-width: 0;
      }

      .search-icon {
        position: absolute;
        left: 12px;
        color: var(--text-secondary);
        font-size: var(--text-sm);
        pointer-events: none;
      }

      .search-hint {
        margin-right: 10px;
        color: var(--text-muted);
        font-size: var(--text-xs);
      }

      .search-empty {
        display: none;
        border: 1px solid var(--border-subtle);
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        padding: 12px 14px;
        box-shadow: var(--shadow-sm);
      }

      .field {
        display: grid;
        gap: var(--space-2);
      }

      .label {
        font-size: var(--text-xs);
        color: var(--text-secondary);
        font-weight: var(--font-medium);
      }

      .card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: var(--space-4);
        box-shadow: var(--shadow-sm);
      }

      .muted {
        color: var(--text-secondary);
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-1) var(--space-3);
        border-radius: 999px;
        font-size: var(--text-xs);
        font-weight: var(--font-medium);
        border: 1px solid var(--border-subtle);
        background: var(--bg-elevated);
        color: var(--text-secondary);
        cursor: pointer;
        user-select: none;
      }

      .chip.active {
        background: rgba(255, 159, 28, 0.16);
        border-color: rgba(255, 159, 28, 0.3);
        color: var(--text-primary);
      }

      .chip-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: var(--border-strong);
      }

      .grid {
        display: grid;
        gap: var(--space-4);
      }

      .pack-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: var(--space-4);
      }

      .pack-card {
        position: relative;
        cursor: pointer;
        transition:
          transform 0.15s ease,
          box-shadow 0.15s ease,
          border-color 0.15s ease;
        min-height: 140px;
        overflow: hidden;
      }

      .pack-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-color: rgba(255, 159, 28, 0.3);
      }

      .pack-card h3 {
        margin: 0 0 var(--space-2) 0;
        font-size: var(--text-base);
        font-weight: var(--font-semibold);
      }

      .pack-meta {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-2);
        align-items: center;
        margin-top: var(--space-3);
        position: relative;
      }

      .pack-meta-badges {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-2);
        flex: 1;
      }

      .pack-preview {
        position: relative;
        height: 120px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-subtle);
        background: linear-gradient(135deg, rgba(255, 159, 28, 0.06), rgba(59, 130, 246, 0.04));
        margin: 0 0 var(--space-3) 0;
        display: grid;
        grid-template-columns: repeat(6, minmax(0, 1fr));
        gap: 6px;
        padding: 10px;
        overflow: hidden;
      }

      .pack-preview::after {
        content: '';
        position: absolute;
        inset: 0;
        background-image:
          linear-gradient(var(--pattern-line) 1px, transparent 1px),
          linear-gradient(90deg, var(--pattern-line) 1px, transparent 1px);
        background-size:
          18px 18px,
          18px 18px;
        pointer-events: none;
        opacity: 0.6;
      }

      .pack-preview-cell {
        border-radius: 10px;
        box-shadow: var(--shadow-sm);
        background: var(--bg-hover);
        min-height: 30px;
        border: 1px solid rgba(0, 0, 0, 0.04);
      }

      .pack-preview.empty {
        align-items: center;
        justify-items: center;
        color: var(--text-secondary);
        font-size: var(--text-sm);
      }

      .pack-preview.empty::after {
        display: none;
      }

      .pack-preview.has-thumb {
        display: block;
        padding: 0;
        grid-template-columns: none;
        gap: 0;
        background: var(--bg-elevated);
      }

      .pack-preview.has-thumb::after {
        opacity: 0.18;
      }

      .pack-preview.has-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .badge {
        font-size: var(--text-xs);
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border-subtle);
        color: var(--text-secondary);
        background: var(--bg-elevated);
      }

      .kebab {
        display: flex;
        align-items: center;
        margin-left: auto;
      }

      .table-wrap {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        /* Allow horizontal scrolling on small screens instead of clipping columns */
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
        box-shadow: var(--shadow-sm);
      }

      table {
        width: 100%;
        min-width: 980px;
        border-collapse: collapse;
        font-size: var(--text-sm);
      }

      .table-wrap table {
        /* Make sure the table keeps its measured width for horizontal scroll */
        width: 100%;
      }

      /* Table footer (pagination + selection summary) */
      .table-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 10px 12px;
        border-top: 1px solid var(--border-subtle);
        background: var(--bg-secondary);
        flex-wrap: wrap;
      }

      .table-footer .tf-left,
      .table-footer .tf-mid,
      .table-footer .tf-right {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
      }

      .table-footer .tf-left {
        color: var(--text-secondary);
        font-size: var(--text-sm);
      }

      .table-footer .tf-label {
        color: var(--text-secondary);
        font-size: var(--text-sm);
      }

      .table-footer select.tf-select {
        background: var(--bg-primary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-sm);
        padding: 6px 10px;
        font-size: var(--text-sm);
        color: var(--text-primary);
      }

      .table-footer .tf-page {
        color: var(--text-secondary);
        font-size: var(--text-sm);
        white-space: nowrap;
      }

      .table-footer .tf-btn {
        border: 1px solid var(--border-subtle);
        background: var(--bg-elevated);
        color: var(--text-primary);
        border-radius: var(--radius-sm);
        width: 34px;
        height: 34px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: var(--shadow-sm);
      }

      .table-footer .tf-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        box-shadow: none;
      }

      .table-footer .tf-btn i {
        color: var(--text-secondary);
      }

      .table-footer .tf-btn:hover:not(:disabled) {
        background: var(--bg-hover);
      }

      @media (max-width: 520px) {
        .table-footer {
          gap: 8px;
        }
        .table-footer .tf-left,
        .table-footer .tf-mid,
        .table-footer .tf-right {
          width: 100%;
          justify-content: space-between;
        }
      }

      th,
      td {
        padding: 12px 12px;
        border-bottom: 1px solid var(--border-subtle);
        text-align: left;
        vertical-align: middle;
        white-space: nowrap;
      }

      th {
        font-size: var(--text-xs);
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: var(--text-secondary);
        background: var(--bg-elevated);
        position: sticky;
        top: 0;
        z-index: 1;
      }

      .th-sort {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border: 0;
        background: transparent;
        color: inherit;
        font: inherit;
        text-transform: inherit;
        letter-spacing: inherit;
        padding: 0;
        cursor: pointer;
        user-select: none;
      }

      .th-sort:focus-visible {
        outline: 2px solid var(--accent-primary);
        outline-offset: 2px;
      }

      .th-chevrons {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        line-height: 1;
        font-size: 0.55rem;
        gap: 0;
      }

      .th-chevron {
        color: var(--text-muted);
        opacity: 0.4;
        transition: opacity 0.12s ease, color 0.12s ease, transform 0.12s ease;
        font-size: 8px;
        line-height: 0.7;
        display: block;
      }

      .th-sort:hover .th-chevron,
      .th-sort:focus-visible .th-chevron {
        opacity: 0.55;
      }

      /* Active direction emphasized but still soft; inactive remains visible (muted) */
      .th-sort.is-asc .th-chevron-up,
      .th-sort.is-desc .th-chevron-down {
        color: var(--text-muted);
        opacity: 0.75;
        transform: none;
      }

      .th-sort.is-asc .th-chevron-down,
      .th-sort.is-desc .th-chevron-up {
        color: var(--text-muted);
        opacity: 0.3;
        transform: none;
      }

      tr:hover td {
        background: rgba(255, 159, 28, 0.05);
      }

      .col-actions {
        width: 44px;
        text-align: right;
      }

      .dropdown {
        position: relative;
        display: inline-block;
      }

      .dropdown-menu {
        position: absolute;
        right: auto;
        left: 0;
        top: calc(100% + 8px);
        min-width: 180px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-lg);
        padding: var(--space-2);
        z-index: 1000;
      }

      .dropdown-item {
        width: 100%;
        border: 0;
        background: transparent;
        color: var(--text-primary);
        padding: var(--space-2) var(--space-3);
        border-radius: var(--radius-sm);
        text-align: left;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: var(--space-2);
        font-size: var(--text-sm);
      }

      .dropdown-item:hover {
        background: var(--bg-hover);
      }

      .dropdown-item[data-variant="danger"] {
        color: var(--error);
      }

      .dropdown-item[data-variant="danger"]:hover {
        background: rgba(239, 68, 68, 0.08);
      }

      .dropdown-item[data-variant="danger"] i {
        color: var(--error);
      }

      .dropdown-item i {
        width: 18px;
        height: 18px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        flex-shrink: 0;
      }

      .dropdown-item:hover i {
        color: var(--text-primary);
      }

      .dropdown-item[data-variant="danger"]:hover i {
        color: var(--error);
      }

      .sort-icon {
        color: var(--text-muted);
        opacity: 0.85;
      }

      /* Modal */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-5);
        z-index: 10000;
      }

      .modal {
        width: min(580px, 100%);
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        overflow: hidden;
      }

      .modal-header {
        padding: var(--space-4) var(--space-5);
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--space-3);
      }

      .modal-title {
        font-size: var(--text-lg);
        font-weight: var(--font-semibold);
        margin: 0;
      }

      .modal-body {
        padding: var(--space-5);
        display: grid;
        gap: var(--space-4);
      }

      .modal-footer {
        padding: var(--space-4) var(--space-5);
        border-top: 1px solid var(--border-subtle);
        display: flex;
        justify-content: flex-end;
        gap: var(--space-2);
      }

      /* Toasts */
      #toast-container {
        position: fixed;
        bottom: 18px;
        right: 18px;
        z-index: 20000;
        display: flex;
        flex-direction: column-reverse;
        gap: 10px;
        max-width: 360px;
      }

      .toast {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-lg);
        padding: 12px 12px;
        display: flex;
        gap: var(--space-3);
        align-items: flex-start;
        cursor: pointer;
        animation: toastIn 0.22s ease;
      }

      .toast-icon {
        width: 26px;
        height: 26px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: var(--font-bold);
        color: white;
        flex: 0 0 auto;
      }

      .toast-body {
        display: grid;
        gap: 4px;
        flex: 1;
        min-width: 0;
      }

      .toast-title {
        font-size: var(--text-sm);
        font-weight: var(--font-semibold);
        line-height: var(--leading-tight);
      }

      .toast-message {
        font-size: var(--text-xs);
        color: var(--text-secondary);
        line-height: var(--leading-normal);
      }

      .toast-actions {
        display: flex;
        gap: var(--space-2);
        margin-top: 6px;
      }

      .toast-btn {
        border: 1px solid var(--border-subtle);
        background: var(--bg-elevated);
        color: var(--text-primary);
        padding: 6px 10px;
        border-radius: var(--radius-sm);
        font-size: var(--text-xs);
        cursor: pointer;
      }

      .toast-btn:hover {
        background: var(--bg-hover);
      }

      @keyframes toastIn {
        from {
          transform: translateX(12px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Editor layout */
      .editor-shell {
        --left-col: 290px;
        --right-col: 340px;
        height: calc(100vh - 58px);
        display: grid;
        grid-template-columns: var(--left-col) 1fr var(--right-col);
        grid-template-rows: 100%;
        gap: var(--space-3);
        padding: var(--space-3);
        background: var(--bg-primary);
      }

      .panel {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-width: 0;
        min-height: 0;
      }

      .panel-header {
        padding: var(--space-3) var(--space-4);
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--space-2);
      }

      .panel-title {
        font-size: var(--text-sm);
        font-weight: var(--font-semibold);
        margin: 0;
      }

      .panel-body {
        padding: var(--space-3);
        overflow: auto;
      }

      .canvas-wrap {
        position: relative;
        min-height: 0;
      }

      #viewport {
        position: absolute;
        inset: 0;
      }

      .viewport-overlay {
        position: absolute;
        left: 12px;
        bottom: 12px;
        background: rgba(0, 0, 0, 0.55);
        color: white;
        padding: 8px 10px;
        border-radius: 10px;
        font-size: var(--text-xs);
        max-width: 360px;
        pointer-events: none;
      }

      .viewport-toolbar {
        position: absolute;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: var(--space-2);
        padding: 8px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.86);
        border: 1px solid rgba(0, 0, 0, 0.08);
        box-shadow: var(--shadow-md);
        backdrop-filter: blur(8px);
      }

      [data-theme='dark'] .viewport-toolbar {
        background: rgba(28, 30, 38, 0.82);
        border-color: rgba(255, 255, 255, 0.08);
      }

      .toolbar-btn {
        border: 1px solid var(--border-subtle);
        background: var(--bg-elevated);
        color: var(--text-primary);
        padding: 7px 10px;
        border-radius: 999px;
        font-size: var(--text-xs);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: var(--shadow-sm);
      }

      .toolbar-btn:hover {
        background: var(--bg-hover);
      }

      .toolbar-btn.active {
        border-color: rgba(255, 159, 28, 0.32);
        background: rgba(255, 159, 28, 0.14);
      }

      /* System overlays */
      .system-overlay {
        position: fixed;
        inset: 0;
        z-index: 30000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: var(--space-6);
        background:
          radial-gradient(circle at 20% 10%, rgba(255, 159, 28, 0.18), transparent 40%),
          radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.12), transparent 45%), rgba(0, 0, 0, 0.65);
      }

      .system-overlay.active {
        display: flex;
      }

      .system-card {
        width: min(760px, 100%);
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        padding: var(--space-6);
      }

      .system-card h2 {
        margin: 0 0 var(--space-2) 0;
        font-size: var(--text-2xl);
      }

      .system-card p {
        margin: 0 0 var(--space-4) 0;
        color: var(--text-secondary);
      }

      .system-list {
        margin: 0;
        padding-left: 18px;
        color: var(--text-secondary);
      }

      /* Responsive */
      @media (max-width: 1279px) {
        .pack-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .editor-shell {
          --left-col: 270px;
          --right-col: 300px;
        }
      }

      @media (max-width: 899px) {
        .app {
          grid-template-columns: 1fr;
        }

        .sidebar {
          position: fixed;
          left: 0;
          top: 0;
          bottom: 0;
          transform: translateX(-102%);
          transition: transform 0.25s ease;
          z-index: 15000;
          width: 240px;
        }

        .sidebar.open {
          transform: translateX(0);
        }

        .topbar {
          position: sticky;
          top: 0;
          z-index: 14000;
        }

        .editor-shell {
          grid-template-columns: 1fr;
          grid-template-rows: 1fr;
          padding: var(--space-3);
        }

        .panel.left,
        .panel.right {
          position: fixed;
          top: 58px;
          bottom: 0;
          width: min(360px, 92vw);
          z-index: 14000;
          transform: translateX(-110%);
          transition: transform 0.25s ease;
        }

        .panel.right {
          right: 0;
          transform: translateX(110%);
        }

        .panel.left.open {
          left: 0;
          transform: translateX(0);
        }

        .panel.right.open {
          transform: translateX(0);
        }

        .pack-grid {
          grid-template-columns: 1fr;
        }
      }
    <!-- ===== END STYLES ===== -->
    </style>
  </head>

  <body>
    <noscript>
      <div style="padding: 20px; font-family: system-ui">This app requires JavaScript enabled.</div>
    </noscript>

    <!-- ===== APP SHELL ===== -->
    <div class="app" id="app">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="brand-mark" aria-hidden="true"></div>
          <div class="brand-text">
            <div class="brand-name">Truck Packer 3D</div>
          </div>
        </div>

        <nav class="nav" aria-label="Primary">
          <button class="nav-btn" type="button" data-nav="packs">
            <i class="fa-solid fa-layer-group"></i>
            Packs
          </button>
          <button class="nav-btn" type="button" data-nav="cases">
            <i class="fa-solid fa-box"></i>
            Cases
          </button>
          <button class="nav-btn" type="button" data-nav="editor">
            <i class="fa-solid fa-cube"></i>
            Editor
          </button>
          <button class="nav-btn" type="button" data-nav="updates">
            <i class="fa-solid fa-bullhorn"></i>
            Updates
          </button>
          <button class="nav-btn" type="button" data-nav="roadmap">
            <i class="fa-solid fa-route"></i>
            Roadmap
          </button>
        </nav>

        <div style="padding: var(--space-3)">
          <button
            class="btn"
            id="btn-account-switcher"
            type="button"
          >
            <span style="display: flex; align-items: center; gap: var(--space-3); min-width: 0">
              <span
                class="brand-mark"
                aria-hidden="true"
                style="width: 34px; height: 34px; border-radius: 12px; flex: 0 0 auto"
              ></span>
              <span style="display: flex; flex-direction: column; align-items: flex-start; min-width: 0">
                <span style="font-weight: var(--font-semibold); line-height: 1.1">Personal Account</span>
                <span class="muted" data-account-name style="font-size: var(--text-sm); line-height: 1.1">â€”</span>
              </span>
            </span>
            <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>
          </button>
        </div>

      </aside>

      <main class="main">
        <header class="topbar">
          <div class="topbar-left">
            <button class="btn btn-ghost" id="btn-sidebar" type="button" title="Menu" aria-label="Menu">
              <i class="fa-solid fa-bars"></i>
            </button>
            <div class="topbar-title">
              <h1 id="topbar-title">Packs</h1>
              <div class="topbar-subtitle" id="topbar-subtitle">Project library</div>
            </div>
          </div>
          <div class="topbar-right">
            <button class="btn" id="btn-export-app" type="button" title="Export app JSON">
              <i class="fa-solid fa-file-export"></i>
              Export
            </button>
            <button class="btn" id="btn-import-app" type="button" title="Import app JSON">
              <i class="fa-solid fa-file-import"></i>
              Import
            </button>
            <button class="btn" id="btn-help" type="button" title="Help">
              <i class="fa-solid fa-circle-info"></i>
              Help
            </button>
          </div>
        </header>

        <div class="content">
          <!-- Packs -->
          <!-- ===== SCREEN: PACKS ===== -->
          <section class="screen" id="screen-packs">
            <div class="row space-between">
              <div class="grid" style="gap: 6px">
                <div style="font-size: var(--text-2xl); font-weight: var(--font-semibold)">Packs</div>
                <div class="muted" style="font-size: var(--text-sm)">
                  Create projects, duplicate, export, and open in the editor.
                </div>
              </div>
              <div class="row" id="packs-actions-default">
                <button class="btn" id="btn-import-pack" type="button">
                  <i class="fa-solid fa-file-import"></i>
                  Import Pack
                </button>
                <button class="btn btn-primary" id="btn-new-pack" type="button">
                  <i class="fa-solid fa-plus"></i>
                  New Pack
                </button>
              </div>
              <div class="row" id="packs-actions-bulk" style="display: none; gap: 8px; align-items: center">
                <div class="muted" id="packs-selected-count" style="font-size: var(--text-sm)"></div>
                <button class="btn btn-danger" id="btn-packs-bulk-delete" type="button">
                  <i class="fa-solid fa-trash"></i>
                  Delete (0)
                </button>
              </div>
            </div>
            <div style="height: 14px"></div>
            <div class="row" style="align-items: center">
              <div style="flex: 1; min-width: 220px; position: relative">
                <i
                  class="fa-solid fa-magnifying-glass"
                  style="
                    position: absolute;
                    left: 10px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: var(--text-muted);
                  "
                ></i>
                <input
                  class="input"
                  id="packs-search"
                  type="text"
                  placeholder="Search packs..."
                  style="padding-left: 30px"
                  aria-label="Search packs"
                />
              </div>
	              <div class="row" style="gap: 4px">
	                <button class="btn" id="packs-view-grid" type="button" title="Grid view" aria-label="Grid view">
	                  <i class="fa-solid fa-grip"></i>
	                </button>
	                <button class="btn" id="packs-view-list" type="button" title="List view" aria-label="List view">
	                  <i class="fa-solid fa-list"></i>
	                </button>
	                <button class="btn" id="packs-trailer-presets" type="button" title="Trailer preset" aria-label="Trailer preset">
	                  <i class="fa-solid fa-truck"></i>
	                </button>
	                <button class="btn" id="packs-filters-toggle" type="button" title="Toggle filters" aria-label="Toggle filters">
	                  <i class="fa-solid fa-filter"></i>
	                </button>
	                <button class="btn" id="packs-card-display" type="button" title="Card display" aria-label="Card display">
	                  <i class="fa-solid fa-pencil"></i>
                </button>
              </div>
              <div class="search-shell" style="flex: 1; min-width: 260px; display: none">
                <div class="search-input"></div>
                <div class="search-empty" id="packs-filter-empty">
                  <div id="packs-filter-empty-msg" style="font-weight: var(--font-semibold); margin-bottom: 4px">
                    No matching packs
                  </div>
                  <div class="muted" style="font-size: var(--text-sm)">
                    Try a different keyword or press Esc to reset search.
                  </div>
                </div>
              </div>
            </div>
            <div style="height: 10px"></div>
            <div class="row" style="gap: 8px; flex-wrap: wrap">
              <button class="chip" id="packs-filter-chip-empty" type="button" title="Packs with 0 cases">
                <span class="chip-dot"></span>
                Empty
              </button>
              <button
                class="chip"
                id="packs-filter-chip-partial"
                type="button"
                title="Packs with some volume used"
              >
                <span class="chip-dot" style="background: var(--warning)"></span>
                Partial
              </button>
              <button
                class="chip"
                id="packs-filter-chip-full"
                type="button"
                title="Packs at 100% volume"
              >
                <span class="chip-dot" style="background: var(--success)"></span>
                Full
              </button>
            </div>
            <div style="height: 14px"></div>
            <div class="pack-grid" id="packs-grid"></div>
            <div class="table-wrap" id="packs-list" style="display: none">
              <table>
                <thead>
                  <tr>
                    <th scope="col" style="width: 36px; text-align: center">
                      <input id="packs-select-all" type="checkbox" aria-label="Select all visible packs" />
                    </th>
                    <th scope="col" data-sort="title">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Title</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
                    <th scope="col" data-sort="cases">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Cases</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
                    <th scope="col" data-sort="length">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Length</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
                    <th scope="col" data-sort="width">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Width</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
	                    <th scope="col" data-sort="height">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">Height</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
	                    <th scope="col" data-sort="mode">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">SHAPE</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
	                    <th scope="col" data-sort="packed">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">Packed</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
                    <th scope="col" data-sort="volume">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Volume</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
                    <th scope="col" data-sort="weight">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Weight</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
                    <th scope="col" data-sort="edited">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Edited</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
                    <th class="col-actions" scope="col"></th>
                  </tr>
                </thead>
                <tbody id="packs-tbody"></tbody>
              </table>
            </div>
            <div class="card" id="packs-empty" style="display: none; margin-top: 16px">
              <div style="font-weight: var(--font-semibold); margin-bottom: 6px">No packs yet</div>
              <div class="muted" style="font-size: var(--text-sm)">Create your first pack to start planning.</div>
            </div>
          </section>

	          <!-- Cases -->
            <!-- ===== SCREEN: CASES ===== -->
	          <section class="screen" id="screen-cases">
	            <div class="row space-between">
	              <div class="grid" style="gap: 6px">
	                <div style="font-size: var(--text-2xl); font-weight: var(--font-semibold)">Cases</div>
	                <div class="muted" style="font-size: var(--text-sm)">
	                  Manage your inventory. Import via CSV/XLSX or create manually.
	                </div>
	              </div>
	              <div class="row" id="cases-actions-default">
	                <button class="btn" id="btn-cases-template" type="button">
	                  <i class="fa-solid fa-download"></i>
	                  Template
	                </button>
	                <button class="btn" id="btn-cases-import" type="button">
	                  <i class="fa-solid fa-file-import"></i>
	                  Import
	                </button>
	                <button class="btn btn-primary" id="btn-new-case" type="button">
	                  <i class="fa-solid fa-plus"></i>
	                  New Case
	                </button>
	              </div>
	              <div class="row" id="cases-actions-bulk" style="display: none; gap: 8px; align-items: center">
	                <div class="muted" id="cases-selected-count" style="font-size: var(--text-sm)"></div>
	                <button class="btn btn-danger" id="btn-cases-bulk-delete" type="button">
	                  <i class="fa-solid fa-trash"></i>
	                  Delete (0)
	                </button>
	              </div>
	            </div>
	            <div style="height: 14px"></div>
            <div class="row" style="gap: 10px; align-items: center">
              <div style="flex: 1; min-width: 220px; position: relative">
                <i
                  class="fa-solid fa-magnifying-glass"
                  style="
                    position: absolute;
                    left: 10px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: var(--text-muted);
                  "
                ></i>
                <input
                  class="input"
                  id="cases-search"
                  type="text"
                  placeholder="Search cases..."
                  style="padding-left: 30px"
                />
              </div>
              <div class="row" style="gap: 4px">
                <button class="btn" id="cases-view-grid" type="button" title="Grid view" aria-label="Grid view">
                  <i class="fa-solid fa-grip"></i>
                </button>
                <button class="btn" id="cases-view-list" type="button" title="List view" aria-label="List view">
                  <i class="fa-solid fa-list"></i>
                </button>
                <button class="btn" id="cases-filters-toggle" type="button" title="Toggle filters" aria-label="Toggle filters">
                  <i class="fa-solid fa-filter"></i>
                </button>
                <button class="btn" id="cases-card-display" type="button" title="Card display" aria-label="Card display">
                  <i class="fa-solid fa-pencil"></i>
                </button>
              </div>
              <button class="btn" id="btn-manage-categories" type="button" title="Categories" aria-label="Categories">
                <i class="fa-solid fa-tags"></i>
              </button>
            </div>
            <div style="height: 10px"></div>
            <div class="row" id="cases-filters" style="gap: 8px"></div>
            <div style="height: 14px"></div>
            <div class="pack-grid" id="cases-grid"></div>
	            <div class="table-wrap">
	              <table>
	                <thead>
	                  <tr>
	                    <th scope="col" style="width: 36px; text-align: center">
	                      <input id="cases-select-all" type="checkbox" aria-label="Select all visible cases" />
	                    </th>
	                    <th scope="col" data-sort="name">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">Name</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
	                    <th scope="col" data-sort="manufacturer">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">Manufacturer</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
	                    <th scope="col" data-sort="length">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">Length</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
	                    <th scope="col" data-sort="width">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">Width</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
	                    <th scope="col" data-sort="height">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">Height</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
	                    <th scope="col" data-sort="volume">
	                      <span class="th-sort" role="button" tabindex="0">
	                        <span class="th-label">Volume</span>
	                        <span class="th-chevrons" aria-hidden="true">
	                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
	                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
	                        </span>
	                      </span>
	                    </th>
                    <th scope="col" data-sort="weight">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Weight</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
                    <th scope="col" data-sort="category">
                      <span class="th-sort" role="button" tabindex="0">
                        <span class="th-label">Category</span>
                        <span class="th-chevrons" aria-hidden="true">
                          <i class="fa-solid fa-chevron-up th-chevron th-chevron-up"></i>
                          <i class="fa-solid fa-chevron-down th-chevron th-chevron-down"></i>
                        </span>
                      </span>
                    </th>
                    <th scope="col">Flip</th>
                    <th class="col-actions" scope="col"></th>
                  </tr>
                </thead>
                <tbody id="cases-tbody"></tbody>
              </table>
            </div>
            <div class="card" id="cases-empty" style="display: none; margin-top: 16px">
              <div style="font-weight: var(--font-semibold); margin-bottom: 6px">No cases found</div>
              <div class="muted" style="font-size: var(--text-sm)">Add cases or import a CSV/XLSX template.</div>
            </div>
          </section>

          <!-- Editor -->
          <!-- ===== SCREEN: EDITOR ===== -->
          <section class="screen" id="screen-editor">
            <div class="editor-shell">
              <div class="panel left" id="editor-left">
                <div class="panel-header">
                  <div class="panel-title">Case Browser</div>
                  <button
                    class="btn btn-ghost"
                    id="btn-left-close"
                    type="button"
                    title="Hide"
                    aria-label="Hide case browser"
                  >
                    <i class="fa-solid fa-xmark"></i>
                  </button>
                </div>
                <div class="panel-body">
                  <div class="field">
                    <div style="position: relative">
                      <i
                        class="fa-solid fa-magnifying-glass"
                        style="
                          position: absolute;
                          left: 10px;
                          top: 50%;
                          transform: translateY(-50%);
                          color: var(--text-muted);
                        "
                      ></i>
                      <input
                        class="input"
                        id="editor-case-search"
                        type="text"
                        placeholder="Search cases..."
                        style="padding-left: 30px"
                      />
                    </div>
                  </div>
                  <div style="height: 12px"></div>
                  <div class="row" id="editor-case-chips" style="gap: 8px"></div>
                  <div style="height: 12px"></div>
                  <div class="grid" id="editor-case-list" style="gap: 10px"></div>
                </div>
              </div>

              <div class="panel canvas-wrap">
                <div id="viewport"></div>
                <div class="viewport-toolbar" id="viewport-toolbar">
                  <button class="toolbar-btn" id="btn-editor-left" type="button" title="Toggle case browser">
                    <i class="fa-solid fa-boxes-stacked"></i>
                    Cases
                  </button>
                  <button class="toolbar-btn" id="btn-editor-right" type="button" title="Toggle inspector">
                    <i class="fa-solid fa-sliders"></i>
                    Inspector
                  </button>
                  <button class="toolbar-btn" id="btn-autopack" type="button" title="AutoPack (Ctrl/Cmd+P)">
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                    AutoPack
                  </button>
                  <button class="toolbar-btn" id="btn-screenshot" type="button" title="Screenshot PNG">
                    <i class="fa-solid fa-camera"></i>
                    Screenshot
                  </button>
                  <button class="toolbar-btn" id="btn-pdf" type="button" title="PDF plan sheet">
                    <i class="fa-solid fa-file-pdf"></i>
                    PDF
                  </button>
                </div>
                <div class="viewport-overlay" id="viewport-hint">
                  Tip: Click to select. Drag to move. Shift+Click for multi-select.
                </div>
              </div>

              <div class="panel right" id="editor-right">
                <div class="panel-header">
                  <div class="panel-title">Inspector</div>
                  <button
                    class="btn btn-ghost"
                    id="btn-right-close"
                    type="button"
                    title="Hide"
                    aria-label="Hide inspector"
                  >
                    <i class="fa-solid fa-xmark"></i>
                  </button>
                </div>
                <div class="panel-body" id="inspector-body"></div>
              </div>
            </div>
          </section>

          <!-- Updates -->
          <section class="screen" id="screen-updates">
            <div class="grid" style="gap: 6px">
              <div style="font-size: var(--text-2xl); font-weight: var(--font-semibold)">Product Updates</div>
              <div class="muted" style="font-size: var(--text-sm)">
                Release notes for buyers. Customize these for your roadmap.
              </div>
            </div>
            <div style="height: 14px"></div>
            <div class="grid" id="updates-list" style="gap: 12px"></div>
          </section>

          <!-- Roadmap -->
          <section class="screen" id="screen-roadmap">
            <div class="grid" style="gap: 6px">
              <div style="font-size: var(--text-2xl); font-weight: var(--font-semibold)">Roadmap</div>
              <div class="muted" style="font-size: var(--text-sm)">
                Set expectations and communicate upcoming features.
              </div>
            </div>
            <div style="height: 14px"></div>
            <div class="grid" id="roadmap-list" style="gap: 16px"></div>
          </section>

          <!-- Settings -->
          <section class="screen" id="screen-settings">
            <div class="row space-between">
              <div class="grid" style="gap: 6px">
                <div style="font-size: var(--text-2xl); font-weight: var(--font-semibold)">Settings</div>
                <div class="muted" style="font-size: var(--text-sm)">Preferences persist locally on this device.</div>
              </div>
            </div>
            <div style="height: 14px"></div>
            <div class="card" style="max-width: 820px">
              <div style="display: grid; gap: 18px">
                <div style="font-weight: var(--font-semibold)">Units</div>
                <div class="row" style="gap: 12px">
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Length</div>
                    <select class="select" id="pref-length">
                      <option value="in">Inches</option>
                      <option value="ft">Feet</option>
                      <option value="mm">Millimeters</option>
                      <option value="cm">Centimeters</option>
                      <option value="m">Meters</option>
                    </select>
                  </div>
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Weight</div>
                    <select class="select" id="pref-weight">
                      <option value="lb">Pounds</option>
                      <option value="kg">Kilograms</option>
                    </select>
                  </div>
                </div>

                <div style="font-weight: var(--font-semibold)">Appearance</div>
                <div class="row" style="gap: 12px">
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Theme</div>
                    <select class="select" id="pref-theme">
                      <option value="light">Light</option>
                      <option value="dark">Dark</option>
                    </select>
                  </div>
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Label size (px)</div>
                    <input class="input" id="pref-label-size" type="number" min="8" max="24" step="1" />
                  </div>
                </div>
                <div class="row" style="gap: 12px">
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Hidden case opacity</div>
                    <input class="input" id="pref-hidden-opacity" type="number" min="0" max="1" step="0.05" />
                  </div>
                </div>

                <div style="font-weight: var(--font-semibold)">Editor</div>
                <div class="row" style="gap: 12px">
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Snapping</div>
                    <select class="select" id="pref-snapping-enabled">
                      <option value="true">Enabled</option>
                      <option value="false">Disabled</option>
                    </select>
                  </div>
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Grid size (in)</div>
                    <input class="input" id="pref-grid-size" type="number" min="0.25" step="0.25" />
                  </div>
                </div>

                <div style="font-weight: var(--font-semibold)">Export</div>
                <div class="row" style="gap: 12px">
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Screenshot resolution</div>
                    <select class="select" id="pref-shot-res">
                      <option value="1920x1080">1920Ã—1080</option>
                      <option value="2560x1440">2560Ã—1440</option>
                      <option value="3840x2160">3840Ã—2160</option>
                    </select>
                  </div>
                  <div class="field" style="flex: 1; min-width: 240px">
                    <div class="label">Include stats in PDF</div>
                    <select class="select" id="pref-pdf-stats">
                      <option value="true">Yes</option>
                      <option value="false">No</option>
                    </select>
                  </div>
                </div>

                <div class="row" style="justify-content: flex-end; gap: 10px">
                  <button class="btn" id="btn-reset-demo" type="button">
                    <i class="fa-solid fa-rotate-left"></i>
                    Reset demo data
                  </button>
                  <button class="btn btn-primary" id="btn-save-prefs" type="button">
                    <i class="fa-solid fa-floppy-disk"></i>
                    Save changes
                  </button>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- ===== GLOBAL UI ROOTS: MODAL + TOASTS ===== -->
    <div id="modal-root"></div>
    <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- ===== GLOBAL UI ROOT: SYSTEM OVERLAY (runtime failures) ===== -->
    <div class="system-overlay" id="system-overlay">
      <div class="system-card">
        <h2 id="system-title">Truck Packer 3D</h2>
        <p id="system-message"></p>
        <ul class="system-list" id="system-list"></ul>
        <div style="height: 14px"></div>
        <div class="row" style="justify-content: flex-end">
          <button class="btn btn-primary" id="system-retry" type="button">
            <i class="fa-solid fa-rotate"></i>
            Retry
          </button>
        </div>
      </div>
    </div>

        <script type="module" src="src/app.js"></script>
  </body>
</html>
